<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://chenyoupu.top</id>
    <title>Youpu的第二大脑</title>
    <updated>2023-10-02T14:11:14.276Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://chenyoupu.top"/>
    <link rel="self" href="https://chenyoupu.top/atom.xml"/>
    <subtitle>Hi，这里是有朴的第二大脑。&lt;br/&gt;很高兴与你相遇</subtitle>
    <logo>https://chenyoupu.top/images/avatar.png</logo>
    <icon>https://chenyoupu.top/favicon.ico</icon>
    <rights>All rights reserved 2023, Youpu的第二大脑</rights>
    <entry>
        <title type="html"><![CDATA[「GWAS那些事儿」heritability的估计有哪些工具/模型？]]></title>
        <id>https://chenyoupu.top/post/gwas-heritability-estimate/</id>
        <link href="https://chenyoupu.top/post/gwas-heritability-estimate/">
        </link>
        <updated>2023-10-02T14:10:09.000Z</updated>
        <content type="html"><![CDATA[<h1 id="写在前面">写在前面</h1>
<ul>
<li>持续更新</li>
</ul>
<ul>
<li>
<p>LDSC：baseline LD model</p>
<p><a href="https://github.com/bulik/ldsc">github.com/bulik/ldsc</a></p>
</li>
<li>
<p>LDAK model</p>
<ul>
<li>
<p><a href="http://dougspeed.com/ldak/">dougspeed.com/ldak/</a>，官方series下载链接</p>
</li>
<li>
<p><a href="https://github.com/takiy-berrandou/LDAK-GBAT-paper-scripts">github.com/takiy-berrand...</a><br /></p>
</li>
<li>
<figure data-type="image" tabindex="1"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20231002220845.png" alt="" loading="lazy"></figure>
</li>
</ul>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「GWAS那些事儿」heritability和genetic correlation估计中的liability scale]]></title>
        <id>https://chenyoupu.top/post/gwas-liability-scale/</id>
        <link href="https://chenyoupu.top/post/gwas-liability-scale/">
        </link>
        <updated>2023-10-02T11:34:52.000Z</updated>
        <content type="html"><![CDATA[<p><strong>liability scale是什么</strong>？</p>
<p>the &quot;liability scale&quot; refers to a hypothetical scale used to model the underlying genetic liability or genetic risk for a specific trait or disease.</p>
<figure data-type="image" tabindex="1"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20231002175826.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「GWAS那些事儿」linear regression中的Z-Score]]></title>
        <id>https://chenyoupu.top/post/gwas-zscore/</id>
        <link href="https://chenyoupu.top/post/gwas-zscore/">
        </link>
        <updated>2023-10-02T11:33:43.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>
<p><strong>Z-score在GWAS summary statistics中的含义是什么</strong>？</p>
<p>The Z-score quantifies how many standard deviations an observed association statistic is from the expected null distribution under the assumption of no association.</p>
<ol>
<li>
<p><strong>Association Testing</strong>: In a GWAS, genetic variants across the genome are tested for their association with a particular trait or disease. The most common statistical test used for this purpose is logistic regression for binary traits (e.g., disease status) or linear regression for continuous traits (e.g., height).</p>
</li>
<li>
<p><strong>Z-Score Calculation</strong>: After performing the association test for each SNP, a Z-score is calculated for that SNP. The formula for calculating the Z-score is typically as follows:</p>
<pre><code class="language-shell">Z = (β - β₀) / SE
</code></pre>
<ul>
<li><code>Z</code> is the Z-score.</li>
<li><code>β</code> is the estimated effect size or regression coefficient for the SNP, representing the change in the trait value associated with each additional copy of the variant.</li>
<li><code>β₀</code> is the null hypothesis value for <code>β</code>, often assumed to be zero under the null hypothesis of no association.</li>
<li><code>SE</code> is the standard error of the estimated effect size <code>β</code>.</li>
</ul>
</li>
<li>
<p><strong>Interpretation</strong>: The Z-score measures how many standard deviations (<code>SE</code>) the estimated effect size (<code>β</code>) is away from the null hypothesis value (<code>β₀</code>). A high absolute Z-score indicates a strong association between the SNP and the trait, whereas a low or close-to-zero Z-score suggests a weak or no association.</p>
</li>
<li>
<p><strong>Significance Threshold</strong>: Researchers typically establish a significance threshold (e.g., Z-score greater than 5 or corresponding p-value threshold) to determine which associations are statistically significant. Associations with Z-scores exceeding this threshold are considered noteworthy and may indicate a genuine genetic influence on the trait or disease.</p>
</li>
<li>
<p><strong>Positive and Negative Z-Scores</strong>: The sign of the Z-score indicates the direction of the effect. A positive Z-score suggests that the variant is positively associated with an increase in the trait (e.g., risk allele for a disease). A negative Z-score suggests a negative association (e.g., protective allele for a disease).</p>
</li>
</ol>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「GWAS那些事儿」LDSC｜LD Score的计算与LD regression构建]]></title>
        <id>https://chenyoupu.top/post/gwas-ldsc/</id>
        <link href="https://chenyoupu.top/post/gwas-ldsc/">
        </link>
        <updated>2023-10-02T11:27:59.000Z</updated>
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2>
<ul>
<li>
<p><strong>什么是LD score</strong>?</p>
<ul>
<li>LD Score衡量了target region的genetic correlation</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">SNP_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>的LD score可以被定义为该SNP与一定范围内其他SNP的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">r^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>之和。​ LD score衡量了该SNP标记的遗传变异性的大小。</li>
</ul>
</li>
<li>
<p><strong>为什么需要开展LD regression analysis</strong>？</p>
<ul>
<li>
<p>在GWAS研究中，多基因性（polygenicity，即若干较小的基因效应）和干扰因素引起的偏差（e.g.，隐性关联 cryptic relatedness，群体分层 population stratification等）都会造成检验的统计量的分布偏高（inflated）</p>
<blockquote>
<ul>
<li>
<p><strong>统计量指什么</strong>？即经过卡方检验检验得到的对应SNP对目标表型的作用，用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>来衡量</p>
</li>
<li>
<p>造成association signal（SNP）对应的统计量分布偏高，是否是真的对目标表型有显著作用（有如此高的作用）？</p>
<p><u>如何将这部分不知道由于是polygenicity造成，还是由populaton stratification等不准确因素造成的effect给估计出来</u>？答案：LD regression（实际上还有很多别的模型来做这这个heritability估计）</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>通过LD score regression，我们可以通过研究检验统计量与连锁不平衡（linkage disequilibrium）之间的关系来定量分析每部分的影响，即对干扰因素平均效应的<strong>估计值</strong>进行计算</p>
</li>
</ul>
</li>
<li>
<p><strong>LD Score的计算原理是什么</strong>？</p>
<p>GWAS检验中，对一个SNP效应量的估计通常也会包含与该SNP成LD的其他SNP的效应，也就是说一个与其他SNP呈现高LD的SNP，通常也会有更高的卡方检验量。</p>
</li>
<li>
<p><strong>LD regression的原理是什么</strong>？</p>
<figure data-type="image" tabindex="1"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20231002180236.png" alt="" loading="lazy"></figure>
</li>
</ul>
<h2 id="ldsc安装">LDSC｜安装</h2>
<ul>
<li>M1芯片不支持（因为LDSC基于Python 2.7）</li>
<li>推荐在Server或者Win虚拟机上运行</li>
</ul>
<pre><code class="language-shell">git clone https://github.com/bulik/ldsc.git
cd ldsc
mamba env create --file environment.yml
mamba activate ldsc
</code></pre>
<h2 id="ldscld-score-calculation">LDSC｜LD Score Calculation</h2>
<ul>
<li>
<p>输入文件：要求PLINK处理过后的genotype数据</p>
<p><code>.bed/.bim/.fam</code>作为输入文件，可以使用PLINK VCF来生成</p>
</li>
<li>
<p>作者推荐的LD Score估计遗传范围（选择用于计算LD Score遗传距离的窗口）：1 centiMorgan (cM) window</p>
<p>可以使用<code>plink --cm-map</code>来保留遗传距离</p>
</li>
<li>
<p>在针对MHC等复杂区域（e.g.，LD延展度更高的region），需要设置更大的window size；具有比较高的recombination rate就不需要设置太大的window size</p>
<p>It is sensible to use a larger window (as measured in kb) in regions like the MHC where LD spans over tens of megabases than in regions with high recombination rate, where LD doesn't extend beyond ~100kb.</p>
</li>
</ul>
<p>以LDSC官方提供的<code>1kg_eur.tar.bz2</code>来说明toy data的结果。</p>
<h3 id="01univariate-ld-score">01）Univariate LD Score</h3>
<pre><code class="language-shell">python ldsc.py\
	--bfile\
	--l2\ 
	--ld-wind-cm 1\ 
	--out 22
</code></pre>
<ul>
<li><code>--l2</code>，指示计算LD Score</li>
<li><code>--ld-wind-cm</code>代表选择的window size（基于遗传距离），还可以直接基于物理距离、SNP个数等</li>
</ul>
<h4 id="结果文件解读">结果文件解读</h4>
<h5 id="122log">1）22.log</h5>
<ul>
<li>
<p>包含所使用的cml以及基本运行结果，</p>
<pre><code class="language-shell">Beginning analysis at Fri Jan 30 10:58:44 2015
Read list of 19156 SNPs from 22.bim
Read list of 379 individuals from 22.fam
Reading genotypes from 22.bed
After filtering, 19156 SNPs remain
～～～Estimating LD Score.～～～
Writing LD Scores for 19156 SNPs to 22.l2.ldscore.gz
</code></pre>
</li>
</ul>
<h5 id="222l2m-22l2m_5_50">2）<code>22.l2.M</code>, <code>22.l2.M_5_50</code></h5>
<ul>
<li>
<p>第一个文件包含了目标region所包含的SNP数目</p>
</li>
<li>
<p>第二个文件包含了过滤MAF（&gt;5%）的SNP数目</p>
<blockquote>
<p>LDSC一般基于后者来进行heritability的估计</p>
</blockquote>
</li>
</ul>
<h5 id="322l2ldscoregz">3）22.l2.ldscore.gz</h5>
<ul>
<li>CHR：chromosome number</li>
<li>SNP：variantID</li>
<li>BP：LDSC自动对variantID对应的物理位置进行排序</li>
</ul>
<pre><code class="language-shell">gunzip -c 22.l2.ldscore.gz | head 

CHR SNP	        BP	        L2
22	rs9617528	16061016	1.271
22	rs4911642	16504399	1.805
22	rs140378	16877135	3.849
22	rs131560	16877230	3.769
22	rs7287144	16886873	7.226
22	rs5748616	16888900	7.379
22	rs5748662	16892858	7.195
22	rs5994034	16894090	2.898
22	rs4010554	16894264	6.975
</code></pre>
<h3 id="02partitioned-ld-score">02）Partitioned LD Score</h3>
<ul>
<li>略</li>
</ul>
<h2 id="ldscld-regression">LDSC｜LD regression</h2>
<p>需要的输入文件，</p>
<ul>
<li>GWAS summary statistics</li>
<li>计算好的LD Score（需要针对对应的人群进行计算）</li>
</ul>
<p>结果文件解读包含：heritability、genetic correlation、LD regression估计出来的intercetp（衡量了polygenicity之外的因素对SNP effect的影响）等</p>
<h3 id="01genetic-correlation-heritability">01）genetic correlation &amp; heritability</h3>
<h4 id="1数据下载-格式转换">1）数据下载 &amp; 格式转换</h4>
<pre><code class="language-shell"># 
wget www.med.unc.edu/pgc/files/resultfiles/pgc.cross.bip.zip
wget www.med.unc.edu/pgc/files/resultfiles/pgc.cross.scz.zip
wget https://data.broadinstitute.org/alkesgroup/LDSCORE/eur_w_ld_chr.tar.bz2
wget https://data.broadinstitute.org/alkesgroup/LDSCORE/w_hm3.snplist.bz2

# 由于GWAS summary statistics不能直接用于ldsc的计算，需要转换
munge_sumstats.py \
--sumstats pgc.cross.SCZ17.2013-05.txt \
--N 17115 \
--out scz \
--merge-alleles w_hm3.snplist

munge_sumstats.py \
--sumstats pgc.cross.BIP11.2013-05.txt \
--N 11810 \
--out bip \
--merge-alleles w_hm3.snplist
</code></pre>
<ul>
<li>
<p>转换之后生成<code>.log</code>文件，包含的信息：使用的命令以及header对应的信息以及对summary statistics过滤的condition信息</p>
<ul>
<li>一般的过滤条件：<code>INFO &gt; 0.9, MAF &gt; 0.01 and 0 &lt; P &lt;= 1.</code>，去除了INDELs、strand ambiguous SNPs、SNPs with duplicated rs numbers</li>
</ul>
</li>
<li>
<p>log文件的最后一部分给出了summary statistics的meta信息，</p>
<pre><code class="language-plaintext">Metadata:
Mean chi^2 = 1.229
Lambda GC = 1.201
Max chi^2 = 32.4
11 Genome-wide significant SNPs (some may have been removed by filtering).

Conversion finished at Mon Apr  4 13:21:29 2016
Total time elapsed: 16.07s 
</code></pre>
</li>
<li>
<p>举个例子，</p>
<pre><code class="language-plaintext">Reading list of SNPs for allele merge from w_hm3.snplist
Read 1217311 SNPs for allele merge.
Reading sumstats from pgc.cross.SCZ17.2013-05.txt into memory 5000000.0 SNPs at a time.
Read 1237958 SNPs from --sumstats file.
Removed 137131 SNPs not in --merge-alleles.
Removed 0 SNPs with missing values.
Removed 256286 SNPs with INFO &lt;= 0.9.
Removed 0 SNPs with MAF &lt;= 0.01.
Removed 0 SNPs with out-of-bounds p-values.
Removed 2 variants that were not SNPs or were strand-ambiguous.
844539 SNPs remain.
Removed 0 SNPs with duplicated rs numbers (844539 SNPs remain).
Using N = 17115.0
Median value of or was 1.0, which seems sensible.
Removed 39 SNPs whose alleles did not match --merge-alleles (844500 SNPs remain).
Writing summary statistics for 1217311 SNPs (844500 with nonmissing beta) to scz.sumstats.gz.
</code></pre>
</li>
</ul>
<h4 id="2遗传力估计-遗传相关性估计">2）遗传力估计 + 遗传相关性估计</h4>
<pre><code class="language-shell"># rg
ldsc.py \
--rg scz.sumstats.gz,bip.sumstats.gz \
--ref-ld-chr eur_w_ld_chr/ \
--w-ld-chr eur_w_ld_chr/ \
--out scz_bip

# h2
ldsc.py \
--h2 scz.sumstats.gz \
--ref-ld-chr eur_w_ld_chr/ \
--w-ld-chr eur_w_ld_chr/ \
--out scz_h2
</code></pre>
<h4 id="参数解读">参数解读</h4>
<ul>
<li>
<p><code>--rg</code>，计算genetic correlation（作者给出的例子中直接以SCZ和bipolar为例）</p>
<ul>
<li>
<p>与使用<code>--h2</code>来计算得到的heritability存在不同</p>
</li>
<li>
<p>作者对此的解释：总的来说就是所使用的SNP dataset不同，rg由于需要同时计算genetic correlation，所以并不是直接使用对应表型的SNP dataset</p>
<figure data-type="image" tabindex="2"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20231002171737.png" alt="" loading="lazy"></figure>
</li>
</ul>
</li>
<li>
<p><code>--w-ld</code>｜<code>--w-ld-chr</code>，在进行<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>N</mi><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">SNP_{j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>的LD回归的估算时，理论上要考虑到该SNP和别的SNP的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">r^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>之和，但是在实际中LD回归对SNP的权重不敏感，所以使用<code>--ref-ld-chr</code>即可</p>
</li>
</ul>
<h4 id="结果解读">结果解读</h4>
<ul>
<li>
<p>以<code>--rg</code>的分析结果为例</p>
<ul>
<li>
<p>Lambda GC，代表了估计结果受到population stratification的影响程度</p>
<p>计算公式：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>a</mi><mi>m</mi><mi>b</mi><mi>d</mi><mi>a</mi><mtext> </mtext><mtext> </mtext><mi>G</mi><mi>C</mi><mo>=</mo><mfrac><mrow><mi>m</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>a</mi><mi>n</mi><mtext> </mtext><mtext> </mtext><mi>c</mi><mi>h</mi><msup><mi>i</mi><mn>2</mn></msup></mrow><mn>0.4549</mn></mfrac></mrow><annotation encoding="application/x-tex">lambda\,\,GC=\frac{median\,\,chi^{2}}{0.4549}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">b</span><span class="mord mathdefault">d</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.36292em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01792em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">.</span><span class="mord mtight">4</span><span class="mord mtight">5</span><span class="mord mtight">4</span><span class="mord mtight">9</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，</p>
<ul>
<li>
<p>0.4549，the expected median of a variable from the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>χ</mi><mn>1</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\chi^{2}_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622159999999998em;vertical-align:-0.24810799999999997em;"></span><span class="mord"><span class="mord mathdefault">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span></span> distribution</p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4406348/">www.ncbi.nlm.nih.gov/pmc...</a></p>
</li>
</ul>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>，通过比较case和control中的genotype得到的卡方统计量</p>
<blockquote>
<ul>
<li>by comparing the observed genotype frequencies in cases (individuals with the trait or disease) and controls (individuals without the trait or disease).</li>
<li>The chi-square statistic measures the extent to which the observed genotype frequencies deviate from what would be expected under the null hypothesis of no association between the SNP and the trait.</li>
</ul>
</blockquote>
</li>
<li>
<p><code>Intercept</code>，the LD Score regression intercept</p>
</li>
<li>
<p>Ratio（<em>attenuation ratio</em>）：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>p</mi><mi>t</mi><mo>−</mo><mn>1</mn></mrow><mrow><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mo>(</mo><mi>c</mi><mi>h</mi><msup><mi>i</mi><mn>2</mn></msup><mo>)</mo><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{intercept-1}{mean(chi^2)-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.427772em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.907772em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.446108em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，用于衡量在LD regression中，polygenicity之外的因素对（理想情况下，应为0）SNP effect的影响（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mtext> </mtext><mtext> </mtext><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">mean\,\,\chi^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>）</p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-shell">Heritability of phenotype 1
---------------------------
Total Observed scale h2: 0.5907 (0.0484)
Lambda GC: 1.2038
Mean Chi^2: 1.2336
Intercept: 1.0014 (0.0113)
Ratio: 0.0059 (0.0482)

Heritability of phenotype 2/2
-----------------------------
Total Observed scale h2: 0.5221 (0.0531)
Lambda GC: 1.1364
Mean Chi^2: 1.1436
Intercept: 1.0013 (0.0094)
Ratio: 0.0093 (0.0652)
</code></pre>
<ul>
<li>
<p>genetic covariance：</p>
<pre><code class="language-shell">Genetic Covariance
------------------
Total Observed scale gencov: 0.3644 (0.0368)
Mean z1*z2: 0.1226
Intercept: 0.0037 (0.0071)
</code></pre>
</li>
<li>
<p>genetic correlaton：</p>
<pre><code class="language-shell">Genetic Correlation
-------------------

Genetic Correlation: 0.6561 (0.0605)
Z-score: 10.8503
P: 1.9880e-27
</code></pre>
</li>
</ul>
<h3 id="02将heritability结果转换到liability-scale">02）将heritability结果转换到liability scale</h3>
<ul>
<li>
<p>由于ldsc估计出来的heritability是obseved scale，为了研究之间的可比较性，需要转换到liability scale，</p>
<pre><code class="language-shell">ldsc.py \
--rg scz.sumstats.gz,bip.sumstats.gz \
--ref-ld-chr eur_w_ld_chr/ \
--w-ld-chr eur_w_ld_chr/ \
--out scz_bip \
--samp-prev 0.5,0.5 \
--pop-prev 0.01,0.01
</code></pre>
</li>
</ul>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://github.com/bulik/ldsc/wiki/LD-Score-Estimation-Tutorial#univariate-ld-scores">LDSC：LD Score的计算</a></li>
<li><a href="https://github.com/bulik/ldsc/wiki/Heritability-and-Genetic-Correlation">LDSC：heritability + genetic correlation的估计</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/379628546">GWAS Lab：LDSC原理</a></li>
<li><a href="https://gwaslab.org/2022/04/04/ld-score/">GWAS Lab：LDSC计算LD Scores</a></li>
</ul>
<h2 id="资源">资源</h2>
<ul>
<li><a href="https://zenodo.org/record/7768714">zenodo.org/record/776871...</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「有谱talk」002｜遇到问题，解决问题]]></title>
        <id>https://chenyoupu.top/post/youputalk002/</id>
        <link href="https://chenyoupu.top/post/youputalk002/">
        </link>
        <updated>2023-09-30T15:43:50.000Z</updated>
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2>
<ul>
<li>
<p>虽然嘴上说着要碰到问题解决问题，但是发现自己好像总是热衷于解决知识上的问题，但是在人际关系上的问题，自己却更倾向于逃避。这一类问题对我来说，又或者说对现在的我来说太难了</p>
</li>
<li>
<p>个人事务上遇到很大的困境，不知该如何解决，所以总是会选择逃避，或者间断性地麻痹自己</p>
</li>
<li>
<p>同时又喜欢在人面前“证明”自己，所谓的成熟，害怕别人如何看待我，觉得我不成熟，但是我不成熟和他人有什么关系？所以现在总在学习赤焰男孩，“nobody cares，我就是我自己世界的王”</p>
<p>但是我也的确发现自己的不成熟，对自己的职业发展不够上心，收集行政事务上的信息、与行政上的人沟通等，这些都是我的弱项，需要在往后的生活中锻炼。</p>
</li>
</ul>
<p>“nobody cares，我就是我自己世界的王”，蛮有意思，自我一点，但是不是自我意识过剩一点。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「有谱音乐说」001｜我是个“健将”]]></title>
        <id>https://chenyoupu.top/post/you-pu-yin-le-shuo-001orwo-shi-ge-jian-jiang/</id>
        <link href="https://chenyoupu.top/post/you-pu-yin-le-shuo-001orwo-shi-ge-jian-jiang/">
        </link>
        <updated>2023-09-30T09:21:13.000Z</updated>
        <content type="html"><![CDATA[<p>我是冷静的</p>
<p>稳定的</p>
<p>从来不任性的</p>
<p>把水端得最平的</p>
<p>不配赢的</p>
<p>站错了队形的</p>
<p>如影随形的破事</p>
<p>哪怕永远不会停</p>
<p>不撕破脸</p>
<p>我会难为情的</p>
<p>我要深刻</p>
<p>要厚重</p>
<p>要工整</p>
<p>不能有漏洞</p>
<p>要说个道理</p>
<p>我要你用效率去对抗虚无</p>
<p>套上件最花的衣服</p>
<p>却排不出体内的瘀毒</p>
<p>我做不到</p>
<p>羞愧于纯粹的快乐</p>
<p>不敢直说我爱着</p>
<p>我不是品</p>
<p>我就是爱喝</p>
<p>押多少才能算合格</p>
<p>都在笑堂吉诃德</p>
<p>为什么作者写窗帘是蓝色的</p>
<p>因为它就是蓝色的</p>
<p>我做不到</p>
<p>我真的在努力去克制</p>
<p>保持我 I内向人的特质</p>
<p>自己对自己呵斥</p>
<p>可我真的需要一首歌的时间放空</p>
<p>我不在乎这是比赛</p>
<p>我要“发疯”</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「有谱talk」001｜利益关系就是最纯洁的关系]]></title>
        <id>https://chenyoupu.top/post/youputalk001/</id>
        <link href="https://chenyoupu.top/post/youputalk001/">
        </link>
        <updated>2023-09-29T16:02:05.000Z</updated>
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2>
<ul>
<li>
<p>我个人在生活中比较礼貌的表现，实际上是为了防止别人伤害到自己，但是最近发生的很多事情，让我意识到一个点，要学会像小恶魔一样，用自己的弱点来武装自己，也还需要允许自己被伤害，还要在人际交往过程中懂得打“好人牌”和“坏人牌”</p>
<blockquote>
<p>让暴风雨来得更猛烈些吧<br>
——高尔基</p>
</blockquote>
</li>
<li>
<p>很多时候是这样的。不仅是在本科，我去教别人东西，别人会很不客气地说来找我“讨论”，实际上自己什么都不会，就仅仅是为了在女生面前装*，我很好奇这样的意义，甚至觉得这样没有意义，自己难道已经忘了自己的身高以及其他优势吗？何必总是维持自己的“完美形象”和“高大形象”</p>
</li>
<li>
<p>到了研究生，居然发现还是这样。</p>
<p>我本希望营造一种与我讨论是没有“架子”的感觉，因为从我之前很多的经历里面出发，找人请教往往需要放低自己的身段，求着别人，别人都不一定肯教（但是其实现在大家都是很好交流的，也没有太大的架子）</p>
<p>可现在的实际呢？你教了朋友东西，所谓的朋友仿佛在背后还要捅你一刀，这样的何必所谓朋友呢？也可能是我贪图了，我可能认为别人也愿意与我交朋友。</p>
</li>
</ul>
<h2 id="最纯洁的关系就是利益关系">最纯洁的关系就是利益关系</h2>
<ul>
<li>
<p>别做朋友，只在乎利益，这样就是最纯洁的关系。</p>
<p>既然本身的出发点就是利益，希望别人帮自己，那就别谈什么友谊、友情、情谊等形而上学的概念，都是放屁。</p>
<p>你对我有所图，我对你有所图，互相满足利益即可，切忌发展朋友关系，因为有的人属实不值得，别太深交。</p>
</li>
</ul>
<h2 id="写在后面">写在后面</h2>
<ul>
<li>
<p>总归来说，还是提升自己连接soft connections的能力，提升自己拉资源的能力，努力让自己成为资源，减少对所谓的朋友的渴求。</p>
<p>朋友，有你会更好，但抱歉，我自己一人时也足够好。</p>
</li>
<li>
<p>抱歉，男女平等、女权主义，我不想讨论，我做好我自己，我尽我所能尊重女性，在需要帮助的时候尽我所能，其余时刻，我只想搞我自己的“事业”，做我自己感兴趣的事，别的事情，我一律不关心。</p>
<ul>
<li>Whatever you said means nothing to me...</li>
<li>尊重他人命运，放下助人情节</li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20230930001906.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「文献写作工作流」002｜siyuan + Zotero联动 - 一篇manuscript的诞生]]></title>
        <id>https://chenyoupu.top/post/wpaper002/</id>
        <link href="https://chenyoupu.top/post/wpaper002/">
        </link>
        <updated>2023-09-28T13:39:02.000Z</updated>
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2>
<ul>
<li>科研中，写作其实是非常重要的一环，就算分析会做，就算算法会整，不能够将自己的想法给清晰地reticulate出来，还是难免会有些折磨</li>
<li>那么从日常的博客写作中，到底能够在“写一篇文章”上帮助到我多少呢？</li>
</ul>
<p>我以一篇review的诞生为例。</p>
<h2 id="idea的产生">idea的产生</h2>
<p>“对一个领域的了解程度，至少需要对这个领域内的100篇经典文献完成阅读”。</p>
<p>100篇并不是一个强制要求的数目，但是侧面的说明了一个问题：</p>
<ul>
<li>这个领域内前人都做了些什么？</li>
<li>这个领域内的热点和痛点是什么？</li>
<li>这个领域内目前最大的challenges是什么？</li>
</ul>
<p>那么针对写一篇综述的任务，就需要researcher对领域内的文章有一个非常inclusive的理解。</p>
<p>我的工作流：Zotero + Bette Notes（plugin）+ 思源笔记</p>
<p>分别简述一个这两个软件的好处，</p>
<ul>
<li>
<p>Zotero：开源，足够多的插件满足我的需求；利用坚果云可以达到很好的跨设备同步，在工位就大电脑主力输出，如果离开工位，则可以使用另一部电脑来查看大电脑的文献笔记等</p>
</li>
<li>
<p>思源笔记：虽然typora很优秀，但是typora也仅仅只能作为markdown的编辑器来使用，并不是一个非常便捷的笔记管理软件。为了更好的实现第二大脑的概念，思源笔记就是我认为非常好的解决方案：</p>
<p>1）本地，重在写作，写在当下，这些都是非常重要的需求。Notion作为一款打开了笔记管理新时代的软件，打开速度让我感觉到很难受，所以就pass。但是不得不说，Notion的数据库功能是非常好用的，因此在文献条目以及笔记阅读等方面，我还是会采用Database + Tag的方式来管理文献。不追求可以的All in One，各取所需即可。</p>
<p>2）相对便捷的设备同步。利用阿里云、腾讯云等云服务，思源笔记也可以非常轻松的实现跨设备同步，但是由于是对整体进行上传，同步速度在wolai、Notion的比较上略逊一筹。</p>
</li>
</ul>
<p>而我所采用的idea收集方式如下，</p>
<ul>
<li>
<p>将Zotero中对应的条目直接复制到思源笔记当中，保存着跳转链接，这个可以让我非常好的对idea追根溯源</p>
<p>同时我以day为单位，每日对综述撰写的内容进行整理和不断补充，当素材足够的时候，即可以直接开始对应部分的撰写，而这两个超链接让我能够很好的找到出处。</p>
<p>做科研，出处是非常重要的。</p>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20230923232138.png" alt="" loading="lazy"></figure>
<h2 id="manuscript的产生">manuscript的产生</h2>
<p>而在思源笔记当中完成了对草稿的撰写之后，我才用的方式如下，</p>
<ul>
<li>
<p>导出。让vscode的markdown做该做的事，</p>
<p>这部分内容实际上是思源笔记现在对citekeys并没有一个非常好的支持，但是D大也说了如果之后思源笔记的科研用户多了，或许会考虑对该功能的更好实现</p>
</li>
<li>
<p>Zotero Better Bibtex + Pandoc帮助生成word版本的manuscript</p>
</li>
</ul>
<h3 id="1better-bibtex的配置">1）better bibtex的配置</h3>
<ul>
<li>citekey format的设置：该部分确定了之后在vscode中要如何对item进行引用</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20230923232814.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>如何想要更好的达到或者说和google scholar保持一致，还有一些内容需要配置，</p>
<ul>
<li>exclusive fields：去除掉导出的bib文件中不需要的field</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20230923232952.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>postscript的设置，</p>
<blockquote>
<p>别问，问就是抄的。该部分只保留对应的info，但是如果其中出现了中文，提取也会出现问题。目前最好的解决方案也还是使用connector添加item时，就对文献的year/Date进行修正，以免后期增多了之后，自己都懒得整理了。小习惯造就big success</p>
</blockquote>
<pre><code class="language-javascript">if (Translator.BetterTeX) {
    if(tex.has['eventtitle']){
        tex.add({
            name: 'booktitle', 
            value: tex.has['eventtitle'].value
        });
        delete tex.has['eventtitle'];
    }
    if(tex.has['date']){
        tex.add({
            name: 'year',
            value: tex.has['date'].value
        });
        delete tex.has['date'];
    }
    if(tex.has['journaltitle']){
        tex.add({
            name: 'journal',
            value: tex.has['journaltitle'].value
        })
        delete tex.has['journaltitle'];
    }
    else if(tex.has['shortjournal']){
        tex.add({
            name: 'journal',
            value: tex.has['shortjournal'].value
        })
        delete tex.has['shortjournal'];
    }
    delete tex.has['shortjournal'];
}
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="2markdown-snippet">2）markdown snippet</h3>
<ul>
<li>
<p>vscode能够有code snippet加快编程效率，那markdown照样也行，</p>
<ul>
<li>
<p>markdonw.json的设置</p>
<blockquote>
<p>start_paper中代表了一整个code snippet，prefix则是我们需要去定义的提示词</p>
</blockquote>
</li>
</ul>
<figure data-type="image" tabindex="4"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20230923233410.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>setting.json的设置。由于vscode中没有默认开启markdown的提示词，因此我们需要修改下，</p>
<figure data-type="image" tabindex="5"><img src="https://youpu777-assets-1308187048.cos.ap-shanghai.myqcloud.com/siyuan-notes/20230923233626.png" alt="" loading="lazy"></figure>
</li>
</ul>
</li>
</ul>
<h3 id="3pandoc">3）pandoc</h3>
<ul>
<li>一款过于经典的工具，各类格式转换都能完成，写这个软件的教授还不是计算机出身，哲学教授嗷！</li>
<li>在此步骤中还可以加入目标期刊的文献要求格式</li>
</ul>
<pre><code class="language-shell">pandoc input.md \
-o test.docx --bibliography test1.bib \
--citeproc -M reference-section-title=&quot;Reference&quot;
</code></pre>
<h2 id="参考资料">参考资料</h2>
<ul>
<li></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[看懂R背后的运行，我五分钟解决了别人一天才能解决的问题]]></title>
        <id>https://chenyoupu.top/post/看懂R背后的运行，我五分钟解决了别人一天才能解决的问题/</id>
        <link href="https://chenyoupu.top/post/看懂R背后的运行，我五分钟解决了别人一天才能解决的问题/">
        </link>
        <updated>2023-06-10T07:21:19.000Z</updated>
        <content type="html"><![CDATA[<h1 id="看懂r背后的运行我五分钟解决了别人一天才能解决的问题">看懂R背后的运行，我五分钟解决了别人一天才能解决的问题</h1>
<p>基于Rscript来直接运行脚本，实际上会存在内存上限的问题（一般出现在tidyverse merge数据的过程中），但是在Linux环境下设置运行内存上限的方法和Win是不一样的，我就用一行代码帮助小伙伴解决了一丢丢小问题，</p>
<pre><code class="language-r">library(unix)
rlimit_as(1e13) # approximately 120G
</code></pre>
<p>结果：三分钟解决问题。。</p>
<p>周末继续总结继续学习继续看文献。</p>
<p>‍</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[「R | parallel」第一篇｜gene level的FST计算]]></title>
        <id>https://chenyoupu.top/post/R  parallel  第一篇/</id>
        <link href="https://chenyoupu.top/post/R  parallel  第一篇/">
        </link>
        <updated>2023-05-15T13:00:56.000Z</updated>
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2>
<ul>
<li>聊聊我自己。群体遗传学研究的对象是allele，而针对一个population，就算是一个population，其内部存在的variants也是相当多的（由于genetic drift的影响），所以要处理的下游数据难免就会呈现records多到“上天”的情况</li>
</ul>
<p>‍</p>
<h2 id="r-parallel的使用">R | parallel的使用</h2>
<p>虽然R语言是一门针对统计学的语言，但并不就代表它不可以实现最基本的计算功能，multiprocessing。</p>
<p>需要使用的packages，<code>parallel</code>​。</p>
<p>就拿我自己做的分析来举例：</p>
<ul>
<li>现存一个vcftools计算得到的FST结果文件，分别记录了从chromosome1到chromosome21的per-site FST计算结果；</li>
<li>我的reference gene BED从UCSC Genome Table Browser下载得到，从共记录了两万多条gene records</li>
</ul>
<p>如何计算得到每一个gene的FST？</p>
<p>前提条件说了很多了，只是为了希望做分析的人能够理解这个问题。</p>
<p>但是在给出自己的代码之前，先给出R parallel的基本使用。</p>
<h3 id="r-parallele-multiprocessing">R | parallele | multiprocessing</h3>
<p>直接使用multiprocessing方法时，不需要自行创建cluster来预设对应包含线程数的sockets，而用起来就像lapply一样，但是与其不同的是，lapply是将所有的函数依次应用到输入的每一个list上，而multiprocessing的lapply则是同时发动所有的任务，</p>
<p>使用函数，</p>
<ul>
<li>mclapply()</li>
<li>mcmapply()</li>
</ul>
<h3 id="r-parallele-sockets">R | parallele | sockets</h3>
<ul>
<li>sockets类型的multiprocessing与上述提到的基本方法，在使用上的不同需要首先创建一个clusters，同时在完成运算之后需要释放这个cluster，</li>
<li>同时还需要将应用的数据export到cluster中</li>
</ul>
<pre><code class="language-r">cluster_1 &lt;- makeCluster(16)  # 可以使用detectCores()来检测总共有多少个核
stopCluster(cluster_1)
</code></pre>
<p>‍</p>
<h2 id="r-我的population-genetics实战">R | 我的population genetics实战</h2>
<ul>
<li>
<p>核心模块，</p>
<p><code>chr.vector</code>​，是包含了chr1tochr22的chromosome tag的向量，需要先将其输出到cluster，才能够应用于cluster计算</p>
<p><strong>但是我还存在的疑问：为什么input_df和gene_bed就不export就不会报错了呢</strong>？</p>
<blockquote>
<p>Note：这里的理解，就好比神经网络模型使用CUDA时，也需要将对应张量加载到GPU上</p>
</blockquote>
<pre><code class="language-r">parLapply(cluster_1, chr.vector, df = input_df, fun = function(input_df, chr_number, gene_bed){
  # retrieve output dataset using chromosome tag {1..21} to split the FST dataset
  chr_number_input_df &lt;- input_df %&gt;% filter(chr==chr_number)
  ...
}
</code></pre>
</li>
</ul>
<pre><code class="language-r">cluster_1 &lt;- makeCluster(16) # using 16 cores to speed up the FST calculation process.
clusterExport(cluster_1, &quot;chr.vector&quot;)  # export chromosome vector the sockets

# 
FST_list &lt;- parLapply(cluster_1, chr.vector, df = input_df, fun = function(input_df, chr_number, gene_bed){
  # retrieve output dataset using chromosome tag {1..21} to split the FST dataset
  chr_number_input_df &lt;- input_df %&gt;% filter(chr==chr_number)
  new_chr_number_input_df = chr_number_input_df %&gt;% left_join(gene_bed, by=c(&quot;chr&quot;))
  
  # only save the validated records
  new_chr_number_input_df &lt;- new_chr_number_input_df %&gt;% filter((pos &gt;= start_pos &amp; pos &lt;= end_pos))
  
  # using 0 to replace negative value
  new_chr_number_input_df$weight_FST[new_chr_number_input_df$weight_FST &lt; 0] &lt;- 0

  # calculate FST for each gene
  cal_df &lt;- new_chr_number_input_df %&gt;% 
              group_by(gene) %&gt;%
              summarize(
                Mean_Fst = mean(weight_FST, na.rm = TRUE)
              )
  return(cal_df)
})

# close cluster
stopCluster(cluster_1)
</code></pre>
<h2 id="推荐阅读">推荐阅读</h2>
<ul>
<li>
<p><a href="https://bookdown.org/rdpeng/rprogdatascience/parallel-computation.html">bookdown.org/rdpeng/rpro...</a></p>
</li>
<li>
<p><a href="https://www.r-bloggers.com/2019/06/parallel-r-socket-or-fork/">www.r-bloggers.com/2019/...</a></p>
<p>创建sockets还可以使用不同的模式。。</p>
</li>
</ul>
<p>‍</p>
]]></content>
    </entry>
</feed>